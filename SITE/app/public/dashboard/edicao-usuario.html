<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="segundo-cadastro" class="login-box">
        <h1 class="main-title">Continue seu cadastro
        </h1>
        <div class="scrollable-content" >
            <form action="#" class="login-form">
                <div class="login-form-fields">
                    <div class="login-form-field">
                        <label for="nome">Nome</label>
                        <input type="text" id="nome_func" name="nome">
                    </div>

                    <div class="login-form-field">
                        <label for="funcao">Função</label>
                        <input type="text" id="funcao_func" name="funcao">
                    </div>  

                    <div class="login-form-field">
                        <label for="email">Email</label>
                        <input type="text" id="email_func" name="email">
                    </div>

                    <div class="login-form-field">
                        <label for="cpf">CPF</label>
                        <input type="text" id="cpf_func" name="cpf">
                    </div>
                </div>
                
                <div class="button" id="btn_enviar">Salvar</div>
            </form>
        </div>
    </div>
</body>
</html>

<script>
    let idUsuario = sessionStorage.getItem("ID_USUARIO_EDITANDO");

    document.addEventListener('DOMContentLoaded', function() {
            addFuncOnButton(idUsuario);
        });


        function addFuncOnButton(idUsuario) {
            let buttonSubmit = document.getElementById('btn_enviar');
            if (buttonSubmit) { 
                buttonSubmit.addEventListener("click", function() {
                    editarUsuario(idUsuario);
                });
            } else {
                console.error("Botão 'bnt_enviar' não encontrado!");
            }
        }

    function listarUsuario(idUsuario) {
        fetch(`/usuarios/listarPorUsuario/${idUsuario}`).then(function (resposta) {
            if (resposta.ok) {
                if (resposta.status == 204) {
                    alert.innerHTML = "Nenhum resultado encontrado."
                    throw "Nenhum resultado encontrado!!";
                }

                resposta.json().then(function (resposta) {
                    // console.log("Dados recebidos: ", JSON.stringify(resposta));
                    nome_func.value = resposta[0].nomeCompleto;
                    funcao_func.value = resposta[0].funcao;
                    email_func.value = resposta[0].email;
                    cpf_func.value = resposta[0].cpf;
                });
            } else {
                throw ('Houve um erro na API!');
            }
        }).catch(function (resposta) {
            console.error(resposta);
        });
    }

    listarUsuario(idUsuario)

    function editarUsuario(idUsuario) {
        fetch(`/usuarios/editarUsuario/${idUsuario}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idUsuario: idUsuario,
                nomeFunc: document.getElementById('nome_func').value,
                funcaoFunc: document.getElementById('funcao_func').value,
                cpfFunc: document.getElementById('cpf_func').value,
                emailFunc: document.getElementById('email_func').value,
            })
        }).then(function (resposta) {
            if (resposta.ok) {
                window.alert("Usuário atualizado com sucesso!");
                window.location = "/dashboard/teste.html"
            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }
</script>